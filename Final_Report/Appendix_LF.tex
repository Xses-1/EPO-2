\chapter{Line Follower} 
\label{appendix_linefollower}
%zou fijn zijn als iemand hier een intro voor kan schrijven
%NOTE CONTROLLER EN ROBOT ZITTEN ER NIET IN, EN DE TESTBENCH ZITTEN ER NIET IN.

\section{Timebase}
\begin{lstlisting}[style=vhdlStyle]
library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.numeric_std.all;

entity timebase is
	port (  clk             : in std_logic;
        	reset           : in std_logic;
        	count_out       : out std_logic_vector (19 downto 0)
 	) ;
 end entity timebase ;

 architecture behavioural of timebase is

 	signal count, new_count : unsigned (19 downto 0);

 begin
 	process ( clk )
 	begin
 		if ( clk'event and clk ='1' ) then
			if ( reset = '1' ) then
 				count <= ( others => '0');
 			else
 				count <= new_count;
 			end if;
 		end if;
 	end process;


 	process ( count )
 	begin

		new_count <= count + 1;

 	end process;

 	count_out <= std_logic_vector ( count );
 end architecture behavioural;
 \end{lstlisting}

\newpage
\section{Motorcontrol}
 \begin{lstlisting}[style=vhdlStyle]
 library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.numeric_std.all;

-- Please add necessary libraries:

entity motorcontrol is
	port (	clk		: in	std_logic;
		reset		: in	std_logic;
		direction	: in	std_logic;
		count_in	: in	std_logic_vector (19 downto 0); 

		pwm		: out	std_logic
	);
end entity motorcontrol;

architecture behavioural of motorcontrol is
	
	type motorcontrol_state is (state0, state1, state2);

	signal state, new_state: motorcontrol_state;

begin 

    process (clk)
    begin
	if (rising_edge (clk)) then
		if (reset = '1') then
    		state <= state0;
		else
				state <= new_state;
		end if;
	end if;
    end process;


    process (direction, count_in, state)
    begin
	case state is

    	when state0 => pwm <= '0';
				new_state<=state1;
			
			when state1 => pwm <= '1';
				if (direction ='0' and unsigned(count_in) >= to_unsigned(50000, 20)) 
                                    then new_state <= state2;
					
				elsif (direction ='1' and unsigned(count_in) >= to_unsigned(100000, 20)) then
				    then new_state <= state2;

				else
					new_state <= state1;
				end if;


			when state2 => pwm <='0';
				new_state <= state2;

		end case;
	end process;
end architecture behavioural;
 \end{lstlisting}

\newpage
\section{Inputbuffer}
 \begin{lstlisting}[style=vhdlStyle]

 library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.numeric_std.all;
-- Please add necessary libraries:


entity inputbuffer is
	port (	clk		: in	std_logic;

		sensor_l_in	: in	std_logic;
		sensor_m_in	: in	std_logic;
		sensor_r_in	: in	std_logic;

		sensor_l_out	: out	std_logic;
		sensor_m_out	: out	std_logic;
		sensor_r_out	: out	std_logic
	);
end entity inputbuffer;

architecture structural of inputbuffer is

component flipflop is 

	port(clk, sensor_l_in, sensor_m_in, sensor_r_in: in std_logic;  
                sensor_l_out, sensor_m_out, sensor_r_out: out std_logic);
end component;

signal s1, s2, s3: std_logic;

begin 

FF1: flipflop port map(	clk => clk, 

			sensor_l_in => sensor_l_in, 
			sensor_m_in => sensor_m_in,  
			sensor_r_in => sensor_r_in, 

			sensor_l_out => s1,
			sensor_m_out => s2,
			sensor_r_out => s3);

FF2: flipflop port map(	clk => clk, 

			sensor_l_in => s1,
			sensor_m_in => s2,
			sensor_r_in => s3,

			sensor_l_out => sensor_l_out,
			sensor_m_out => sensor_m_out,
			sensor_r_out => sensor_r_out);

end structural;
 \end{lstlisting}

\newpage
\section{3bit\textunderscore{flipflop}}
 \begin{lstlisting}[style=vhdlStyle]
 library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.numeric_std.all;
-- Please add necessary libraries:


entity flipflop is
	port (	clk		: in	std_logic;

		sensor_l_in	: in	std_logic;
		sensor_m_in	: in	std_logic;
		sensor_r_in	: in	std_logic;

		sensor_l_out	: out	std_logic;
		sensor_m_out	: out	std_logic;
		sensor_r_out	: out	std_logic
	);
end entity flipflop;


architecture behavioral of flipflop is 

begin
	process (clk)
	begin 
		if rising_edge(clk) then
			sensor_l_out <= sensor_l_in;
			sensor_m_out <= sensor_m_in;
			sensor_r_out <= sensor_r_in;

		end if;
	end process;

end behavioral;
\end{lstlisting}

\newpage

\section{Controller}
\begin{lstlisting}[style=vhdlStyle]
 
\end{lstlisting}

\newpage

\section{Robot}
\begin{lstlisting}[style=vhdlStyle]


 \end{lstlisting}
